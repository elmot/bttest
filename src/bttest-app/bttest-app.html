<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/platinum-bluetooth/platinum-bluetooth-elements.html">

<dom-module id="bttest-app">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <h2>Bttest</h2>
        <platinum-bluetooth-device id="device" services-filter='["battery_service"]'>
            <platinum-bluetooth-service id="service" service='battery_service'>
                <platinum-bluetooth-characteristic id="batteryLevel" characteristic='battery_level'>
                </platinum-bluetooth-characteristic>
            </platinum-bluetooth-service>
        </platinum-bluetooth-device>
        <button id="btn" on-click="_onButtonClick">Click</button>
        <template is="dom-if" if="batteryLevel">
          <p>Battery level is: [[batteryLevel]]%</p>
        </template>
    </template>

    <script>
        Polymer({

            is: 'bttest-app',

            properties: {
              batteryLevel: Number
            },
            _onButtonClick: function () {
                this.$.device.request().then(function () {
                    return this.$.batteryLevel.read().then(function (value) {
                        this.batteryLevel = value.getUint8(0);
                    }.bind(this));
                }.bind(this))
                .catch(function (error) {
                    console.error(error)
                });
            }

        });
    </script>
</dom-module>
